<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>日本語や漢字の日付をPythonのdatetimeに変換するライブラリを作った - 塩の惑星</title><meta name="description" content="日本語文章を解析しているときに地味に困る物の一つに漢字等の日本語で書かれた年月日があります。 今回は、日本語で書かれた日付のデータをPythonのdatetime、timedeltaに変換するライブラリを作成したので紹介します。 ※ datetimeは日時、timedeltaは時間（時間差）を取り扱うPython標準オブジェクトです kanji_to_timeという名前のライブラリです。&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://corkborg.github.io/created-kanji-to-time/"><link rel="alternate" type="application/atom+xml" href="https://corkborg.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://corkborg.github.io/feed.json"><meta property="og:title" content="日本語や漢字の日付をPythonのdatetimeに変換するライブラリを作った"><meta property="og:image" content="https://corkborg.github.io/media/posts/35/Ming-Cheng-Wei-She-Ding-huairu-1711796415700.drawio-1.png"><meta property="og:image:width" content="570"><meta property="og:image:height" content="270"><meta property="og:site_name" content="塩の惑星"><meta property="og:description" content="日本語文章を解析しているときに地味に困る物の一つに漢字等の日本語で書かれた年月日があります。 今回は、日本語で書かれた日付のデータをPythonのdatetime、timedeltaに変換するライブラリを作成したので紹介します。 ※ datetimeは日時、timedeltaは時間（時間差）を取り扱うPython標準オブジェクトです kanji_to_timeという名前のライブラリです。&hellip;"><meta property="og:url" content="https://corkborg.github.io/created-kanji-to-time/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://corkborg.github.io/media/website/icon.ico" type="image/x-icon"><link rel="stylesheet" href="https://corkborg.github.io/assets/css/prism.css?v=b46352844c4922bafa71c2012d20bbac"><link rel="stylesheet" href="https://corkborg.github.io/assets/css/style.css?v=84f9c70dec94b79716bfc8c68779f628"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://corkborg.github.io/created-kanji-to-time/"},"headline":"日本語や漢字の日付をPythonのdatetimeに変換するライブラリを作った","datePublished":"2024-03-30T19:21","dateModified":"2024-04-08T13:33","image":{"@type":"ImageObject","url":"https://corkborg.github.io/media/posts/35/Ming-Cheng-Wei-She-Ding-huairu-1711796415700.drawio-1.png","height":270,"width":570},"description":"日本語文章を解析しているときに地味に困る物の一つに漢字等の日本語で書かれた年月日があります。 今回は、日本語で書かれた日付のデータをPythonのdatetime、timedeltaに変換するライブラリを作成したので紹介します。 ※ datetimeは日時、timedeltaは時間（時間差）を取り扱うPython標準オブジェクトです kanji_to_timeという名前のライブラリです。&hellip;","author":{"@type":"Person","name":"ミズソバ","url":"https://corkborg.github.io/authors/mizusoba/"},"publisher":{"@type":"Organization","name":"ミズソバ","logo":{"@type":"ImageObject","url":"https://corkborg.github.io/media/website/logo2.png","height":344,"width":1000}}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8CYBCM4RJ"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8CYBCM4RJ');</script></head><body><header><div id="header-upper"><div></div><a class="main-logo" href="https://corkborg.github.io/"><img src="https://corkborg.github.io/media/website/logo2.png" alt="塩の惑星" height="80px"></a><div></div></div><div><nav class="menu-navbar"><div class="menu"><div><a href="https://corkborg.github.io/contact/" target="_self">問い合わせ</a></div></div></nav></div></header><div id="main-wrapper-with-sidebar"><main><article class="post-only"><header><h1>日本語や漢字の日付をPythonのdatetimeに変換するライブラリを作った</h1><div class="modified-time">公開日: <time datetime="2024-03-30T19:21">2024-03-30 </time><span id="post-tags"><span class="post-tag"><a href="https://corkborg.github.io/tags/puroguramingu/">プログラミング </a></span><span class="post-tag"><a href="https://corkborg.github.io/tags/japanese/">日本語周り</a></span></span></div></header><figure id="featured-image"><img src="https://corkborg.github.io/media/posts/35/Ming-Cheng-Wei-She-Ding-huairu-1711796415700.drawio-1.png" srcset="https://corkborg.github.io/media/posts/35/responsive/Ming-Cheng-Wei-She-Ding-huairu-1711796415700.drawio-1-xs.png 300w, https://corkborg.github.io/media/posts/35/responsive/Ming-Cheng-Wei-She-Ding-huairu-1711796415700.drawio-1-sm.png 480w, https://corkborg.github.io/media/posts/35/responsive/Ming-Cheng-Wei-She-Ding-huairu-1711796415700.drawio-1-md.png 749w, https://corkborg.github.io/media/posts/35/responsive/Ming-Cheng-Wei-She-Ding-huairu-1711796415700.drawio-1-xl.png 1200w" sizes="(max-width: 1200px) 100vw, 1200px" loading="eager" height="270" width="570" alt=""></figure><div id="post-entry"><p>日本語文章を解析しているときに地味に困る物の一つに漢字等の日本語で書かれた年月日があります。</p><p>今回は、日本語で書かれた日付のデータをPythonのdatetime、timedeltaに変換するライブラリを作成したので紹介します。</p><p>※ datetimeは日時、timedeltaは時間（時間差）を取り扱うPython標準オブジェクトです</p><hr><p><strong>kanji_to_time</strong>という名前のライブラリです。</p><p><a href="https://github.com/corkborg/kanji_to_time" target="_blank" rel="noopener noreferrer">https://github.com/corkborg/kanji_to_time</a><br><a href="https://pypi.org/project/kanji-to-time/" target="_blank" rel="noopener noreferrer">https://pypi.org/project/kanji-to-time/</a></p><p>こんな感じでインストールできます。</p><pre class="language-bash"><code>pip install kanji_to_time</code></pre><h2>こんな変換ができます</h2><p>半角、漢字混じり、漢数字、全角数字などを変換できます。</p><pre class="language-python"><code>&gt;&gt;&gt; import kanji_to_time as ktt
&gt;&gt;&gt; text = "2024年4月5日22時30分4秒"
&gt;&gt;&gt; ktt.to_datetime(text)
datetime.datetime(2024, 4, 5, 22, 30, 4)</code></pre><pre class="language-python"><code>&gt;&gt;&gt; ktt.to_timedelta("マイナス七〇億分")
datetime.timedelta(days=-4861112, seconds=76800)</code></pre><p>旧字の漢数字などにも対応しています。</p><pre class="language-python"><code>&gt;&gt;&gt; ktt.to_datetime("弐零弐参年伍月肆日")
datetime.datetime(2023, 5, 4, 0, 0)</code></pre><p>今のところ億の位まで対応しています。</p><pre class="language-python"><code>&gt;&gt;&gt; ktt.to_timedelta("3億二三万千７十１秒間")
datetime.timedelta(days=3474, seconds=77471)</code></pre><h2>機能ポイント</h2><ul><li>数値部分の文字数が可変でも変換可能です（ゼロ埋めの必要が無い）</li><li>半角全角漢数字が混じっていても変換することができます。</li><li>20秒、20秒間のように位の後ろに間が付いていても同様に変換することができます（timdelta変換のみ）。</li></ul><h2>どうやって作ったか？</h2><p>当初、そんなに難しいコードを書かなくても解決できるだろうと考えていました。</p><p>しかし、単純そうに見えて時間の変換はルールが多くてシンプルなコードでは実現できないことがわかりました。</p><p>このようなルールがある文章を処理する場合、一番手軽なのは正規表現です。私も当初はreを使って解決しようと思ったのですが、実装している途中で正規表現で実現すると大変複雑で自分ですら理解できないようなコードになってしまうことに気づきました。</p><p>手間を惜しまなければ、ルールが複雑な文章（文法）を相手にする際にはパーサージェネレータを使ったほうが良いです。Pythonでおすすめのパーサージェネレータを調べた所Larkというものがヒットしたのでこれを使用して作成しました。</p><p><a href="https://lark-parser.readthedocs.io/en/stable/">Larkの公式ドキュメント</a></p><p>今回は、kanji_to_timeのパーサの中でも数字の周りの文法ルールだけを抜き出して紹介します。</p><pre class="language-javascript"><code>number: (MINUS | PLUS)? mixed_number_with_unit
mixed_number_with_unit: unit_oku? unit_man? unit_sen? unit_juu? mixed_number?

MINUS: "-" | "ー" | "マイナス" | "ひく" | "引く"
PLUS: "+" | "＋" | "プラス" | "たす" | "足す"

unit_oku: mixed_number "億" // 億は数値が必須
unit_man: mixed_number "万" // 万は数値が必須
unit_sen: mixed_number? "千"
unit_juu: mixed_number? "十"

mixed_number: (ZENKAKU_DIGIT | KANJI_DIGIT | DIGIT)+
KANJI_DIGIT: "一" | "壱"
           | "二" | "弐"
           | "三" | "参"
           | "四" | "肆"
           | "五" | "伍"
           | "六" | "陸"
           | "七" | "漆"
           | "八" | "捌"
           | "九" | "玖"
           | "〇" | "ゼロ" | "零"
           | "○" | "◯" // 一応丸もサポートしておく
ZENKAKU_DIGIT: "０" | "１" | "２" | "３" | "４" | "５" | "６" | "７" | "８" | "９"</code></pre><p>KANJI_DIGITという漢数字を読むだけの文法のルールをがありますが、このルールはmixed_numberというルールに参照されています。そして、mixed_numberはkanji_digitの他に全角、半角数値も参照していてそれらを統合しています。</p><p>このように局所的な文法ルールが大域的な文法ルールで参照されることで、文法を木構造で表現することができます。</p><p>上記のルールでは最終的にnumberという一番大域的なルールにそれぞれのルールが参照されている形になっています。</p><p>Larkの文法ルールを用意したら、Python側でルールを実際に変換するコードを書いてやれば複雑なルールの文章を構造的にプログラミング言語の型に変換することができます。大変便利ですね。</p><p>全体のkanji_to_timeの文法ルール全体はここから見れます。<br><a href="https://github.com/corkborg/kanji_to_time/blob/main/kanji_to_time/grammer/kanji_to_time.lark">https://github.com/corkborg/kanji_to_time/blob/main/kanji_to_time/grammer/kanji_to_time.lark</a></p><h2>一応漢数字の変換もできる</h2><p>Larkの文法定義を見てもらうとわかるのですが、数値変換だけの文法ルールが存在するので数値変換だけを行うこともできます。</p><p>一応調査用に漢数字から数値に変換する機能もあります。</p><pre class="language-python"><code>&gt;&gt;&gt; ktt.to_number("八千七十二")
8072</code></pre><p>ただ、漢数字の数値変換についてはKanjizeという優れた先行ライブラリが存在するのでこの用途だけであればこちらを使ったほうが良いと思います。<br><a href="https://github.com/nagataaaas/Kanjize" target="_blank" rel="noopener noreferrer">https://github.com/nagataaaas/Kanjize</a></p><h2>サポート</h2><p>このような日付文字列を変換する際にはぜひ使ってみてください。</p><p>不具合などに気づいたらissuesに投稿してもらえると嬉しいです。<br><a href="https://github.com/corkborg/kanji_to_time/issues" target="_blank" rel="noopener noreferrer">https://github.com/corkborg/kanji_to_time/issues</a></p><p> </p></div><div class="modified-time">更新日: <time datetime="2024-04-08T13:33">2024-04-08</time></div><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcorkborg.github.io%2Fcreated-kanji-to-time%2F" class="js-share facebook" title="Share with Facebook" rel="nofollow noopener noreferrer" aria-label="Share with Facebook"><svg class="u-icon"><use xlink:href="https://corkborg.github.io/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fcorkborg.github.io%2Fcreated-kanji-to-time%2F&amp;via=%E5%A1%A9%E3%81%AE%E6%83%91%E6%98%9F&amp;text=%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%82%84%E6%BC%A2%E5%AD%97%E3%81%AE%E6%97%A5%E4%BB%98%E3%82%92Python%E3%81%AEdatetime%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F" class="js-share twitter" title="Share with Twitter" rel="nofollow noopener noreferrer" target="_blank" aria-label="Share with Twitter"><svg class="u-icon"><use xlink:href="https://corkborg.github.io/assets/svg/svg-map.svg#twitter"/></svg></a></div><nav id="post-navigation"><div class="post-navigation-link"><a href="https://corkborg.github.io/raspberrypi-5-vs-intel-core-i5-2500/" rel="prev">&larr; 前の記事: RaspberryPi 5の性能はSandyBridge i5-2500に近いことに気づいた</a></div><div class="post-navigation-link"><a href="https://corkborg.github.io/planted-plants-in-ada-cell/" rel="next">次の記事: 湿度の好む植物向けの鉢. ADAのCELLに植物を植えてみた &rarr;</a></div></nav></article></main><aside><section><h3>Featured posts</h3><ol class="featured-posts__list"><li><a href="https://corkborg.github.io/created-kanji-to-time/" class="invert">日本語や漢字の日付をPythonのdatetimeに変換するライブラリを作った</a></li><li><a href="https://corkborg.github.io/publii-is-good-website-generator/" class="invert">使いやすいエディターで静的サイト生成できるPubliiがおすすめな話</a></li><li><a href="https://corkborg.github.io/energy-saving-battle-gaming-pc-vs-apple-silicon-mac/" class="invert">ゲーミングPCは電気代が高い！電気代が安いApple Silicon Macのゲームでの省電力能力を検証</a></li><li><a href="https://corkborg.github.io/steam-games-support-apple-silicon/" class="invert">Apple Silicon Macで遊べるゲームリスト. M1 Macで検証してみた</a></li><li><a href="https://corkborg.github.io/arma3-support-apple-silicon-m1-macbook-air/" class="invert">Arma3はApple Siliconにネイティブ対応している？M1 MacBook Airで試してみた</a></li></ol></section></aside></div><footer><nav class="menu-navbar"><div class="menu"><div><a href="https://corkborg.github.io/contact/" target="_self">問い合わせ</a></div></div></nav><div id="footer-lower"><div></div><a class="main-logo" href="https://corkborg.github.io/"><img src="https://corkborg.github.io/media/website/logo2.png" alt="塩の惑星" height="80px"></a><div></div></div></footer><script defer="defer" src="https://corkborg.github.io/assets/js/prism.js?v=2730b884bcd782a7b6ffd13dcb5504c0"></script><script async src="https://corkborg.github.io/assets/js/scripts.js?v=3733efd39cd6c799b95c8fcb96993840"></script></body></html>